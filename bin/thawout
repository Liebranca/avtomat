#!/usr/bin/perl
# ---   *   ---   *   ---
# THAWOUT
# Loads a serialized Perl object
# from disk and prints it out
#
# LIBRE SOFTWARE
# Licensed under GNU GPL3
# be a bro and inherit
#
# CONTRIBUTORS
# lib,

# ---   *   ---   *   ---
# deps

package thawout;
  use v5.42.0;
  use strict;
  use warnings;

  use English qw($ARG);
  use Storable qw(retrieve);

  use lib "$ENV{ARPATH}/lib/sys/";
  use Arstd::fatdump;
  use Arstd::throw;
  use Arstd::Array qw(iof);


# ---   *   ---   *   ---
# get '-p' flag

my @path=();
my $path=iof \@ARGV,'-p';
if(defined $path) {
  $path=$ARGV[$path+1] or throw(
    "'-p' flag passed, but no path provided"
  );

  @path=split qr{:+},$path;
  @ARGV=grep {
    $ARG ne '-p' && $ARG ne $path

  } @ARGV;
};


# ---   *   ---   *   ---
# get '-r' flag

my $recurse=iof \@ARGV,'-r';
if(defined $recurse) {
  $recurse=1;
  @ARGV=grep {$ARG ne '-r'} @ARGV;

} else {
  $recurse=0;
};


# ---   *   ---   *   ---
# the bit

for(@ARGV) {
  my $h=retrieve $_ or throw $_;
     $h=$h->{$ARG} for @path;

  fatdump \$h,blessed=>1,recurse=>$recurse;
};


# ---   *   ---   *   ---
1; # ret
