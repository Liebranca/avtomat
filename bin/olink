#!/usr/bin/perl
# ---   *   ---   *   ---
# OLINK
# Wraps over compiling and
# linking C files with gcc
#
# LIBRE SOFTWARE
# Licensed under GNU GPL3
# be a bro and inherit
#
# CONTRIBUTORS
# lyeb,

# ---   *   ---   *   ---
# deps

package main;

  use v5.36.0;
  use strict;
  use warnings;

  use Cwd qw(abs_path);
  use English qw(-no_match_vars);
  use lib $ENV{'ARPATH'}.'/lib/sys/';

  use Style;
  use Arstd::WLog;

  use Cli;
  use Shb7;

  use Shb7::Bk::gcc;
  use Shb7::Build;

  use Avt::CRun;

# ---   *   ---   *   ---
# info

  our $VERSION = v1.00.2;
  our $AUTHOR  = 'IBN-3DILA';

# ---   *   ---   *   ---
# define arguments for commandline

my $m=Cli->nit(

  @{$Cli::Fstruct::ATTRS},

  {id=>'libs',short=>'-l',argc=>1},
  {id=>'incl',short=>'-I',argc=>1},
  {id=>'out',short=>'-o',argc=>1},

  {id=>'debug',short=>'-g',argc=>0},
  {id=>'-pg',short=>'-pg',argc=>0},

);

my @files=Cli::Fstruct::proto_search($m);

# ---   *   ---   *   ---
# sanitize input

for my $v($m->{incl},$m->{libs}) {
  $v=$NULLSTR if $v eq $NULL

};

$m->{out}=($m->{out} eq $NULL)
  ? undef
  : $m->{out}
  ;

# ---   *   ---   *   ---
# cstruc builder ice

my $crun=Avt::CRun->new(

  name  => $m->{out},

  libs  => $m->{libs},
  incl  => $m->{incl},

  debug => $m->{debug} ne $NULL,
  files => \@files,

);

# ---   *   ---   *   ---
# compile files and link them

$WLog->mprich('AR','running olink');
$crun->compile();
$crun->link();

# ---   *   ---   *   ---
1; # ret
