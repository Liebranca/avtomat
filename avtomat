#!/usr/bin/perl

# ---   *   ---   *   ---
# AVTOMAT
# build helper and initializer
# generated files manager
#
# LIBRE SOFTWARE
# Licensed under GNU GPL3
# be a bro and inherit
#
# CONTRIBUTORS
# lyeb
# ---   *   ---   *   ---

# deps
package main;

  # note that avtomat does not use ARPATH/lib
  # this is only so that it can install itself
  use lib $ENV{'ARPATH'}.'/avtomat/';
  use avt;

# entry point

  if(!@ARGV || $ARGV[0] eq 'help') {
    # put helper here
    exit;

  };my $root=avt::root(shift);
  chdir $root;

# ---   *   ---   *   ---
# run

  my $task=shift;my %tasks=(
    'scan'    => \&avt::scan,
    'config'  => \&avt::config,
    'make'    => \&avt::make,

  );

  # valid arg
  if(grep m/${ task }/,keys %tasks) {
    $tasks{$task}->(@ARGV);

  # invalid
  } else {
    print "Unrecognized '$task'\n";


  };

# ---   *   ---   *   ---

my $log=
  'AR/AVTOMAT: last run by '.
  $ENV{'USER'}.'@'.$ENV{'HOSTNAME'}.
  ' on '.`date`."\n\n";

`echo "$log" > $root/.avto`;

# ---   *   ---   *   ---
1; # ret
