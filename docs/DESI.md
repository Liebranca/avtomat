# DO NOT USE YET

This is a design paper written down for reference. If you are reading this bit, then that means I'm still implementing some of this stuff and you should NOT run avtomat under any circumstance, do you hear me? DO NOT run avtomat if this disclaimer is still here.

# AVTOMAT

This is a build helper designed to relieve me of the burden of maintaining makefiles; GNU make is my tool of preference for automating builds, but writing it's input by hand could age me a decade in a single afternoon.

So I made avtomat, which generates config files for a given directory containing modules and submodules of a project; these config files are then used to generate makefiles.

As a plus, it also keeps track of generated files by both itself and make.

# USAGE

```
avtomat <dir> <task> [<items>]

```

**dir** is a directory to be scanned for projects to build, and where configuration files as well as the *trashcan* files are saved to. Because avtomat is meant to manage multiple inter-dependent projects at a time, you must always specify their parent directory.

**task** is simply put which function call you want to make. These are as follows:

- *scan*: recursively walk directories matching `items` within `dir` and output a list of paths and source files found
- *config*: nit/set build options for modules matching `items`
- *make*: emit a makefile for `items` matching config

**items** works slightly different for each task.

For **scan** `items` equals a list of directories within `dir` you want to work with, e.g. `avtomat ~/my-projects/ scan module_a module_b`

# CONFIG FILES

For **config**, `items` represent build options for a module; so this is slightly more involved. A config file is made of lists of comma-separated items, each separated by a single space:

```
BUILD XCPY LCPY GENS LIBS INCL DEFS

```

Let's unpack that.

- BUILD can be `[x|so|l]`; executable, shared object and static library, respectively. This option is only important for modules which contain code that requires compilation
- XCPY is a list of either scripts or pre-compiled binaries that already live within the module folder and must be copied to the local `bin`, relative to the project folder
- LCPY is the same, but for `lib`
- GENS lists either scripts or binaries that must be run to generate a dependency
- LIBS lists both additional library search directories and the libraries themselves
- INCL is for additional include paths
- Finally, DEFS is for macro definitions; it can be used for modifying the build environment

Processing of each of these lists can be skipped by passing them as a single `.` dot. Note that the `lib` and `include` folders relative to the project directory will always be used, so do not specify them.

Furthermore, for `LIBS` and `INCL` you musn't pass `-L`, `-l` or `-I` switches; all your paths must contain at least a single `/` slash so that they can be identified as proper paths; `..` two dots and `~` (ascii)tilde work relative to the symbolic `ROOT`, which refers to the top folder, or project directory as set by the initial call to avtomat.

For an example script that sets up a project, refer to the `AR-install` file provided with avtomat.

# THE TRASHCAN

avtomat creates a disposable directory within the projects folder called *trashcan*. This directory contains all intermediate files generated by a build; object files, pre-compiled headers, disassemblies, you name it. All those are put away in their own mirror folder structure in order to keep clutter away from your source files.

# BEWARE

Files generated by avtomat, as well as headers, version prints and related notices 
include this bit by default:

```perl
'Copyleft '.$AUTHOR.' '.$YEAR.'; Licensed under GNU GPL3';
```

Which means that if you do not agree with the license you will have to do the 
legal homework yourself there. But seriously? Just be a bro and inherit.
