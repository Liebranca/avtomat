# DO NOT USE YET

This is a design paper written down for reference. If you are reading this bit, then that means I'm still implementing some of this stuff and you should NOT run avtomat under any circumstance, do you hear me? DO NOT run avtomat if this disclaimer is still here.

# AVTOMAT

This is a build helper designed to relieve me of the burden of maintaining makefiles; GNU make is my tool of preference for automating builds, but writing it's input by hand could age me a decade in a single afternoon.

So I made avtomat, which generates config files for a given directory containing modules and submodules of a project; these config files are then used to generate makefiles.

As a plus, it also keeps track of generated files by both itself and make.

# USAGE

```
avtomat <dir> <task> [<items>]

```

**dir** is a directory to be scanned for projects to build, and where configuration files as well as the *trashcan* files are saved to. Because avtomat is meant to manage multiple inter-dependent projects at a time, you must always specify their parent directory.

**task** is simply put which function call you want to make. These are as follows:

- *scan*: recursively walk directories matching `items` within `dir` and output a list of paths and source files found
- *config*: nit/set build options for modules matching `items`
- *make*: emit a makefile for `items` matching config

**items** works slightly different for each task.

For **scan** and **make**, `items` equals a list of directories within `dir` you want to work with, e.g. `avtomat ~/my-projects/ scan module_a module_b`

For **config**, `items` takes the form `module_a "config" module_b "config"`, where `"config"` is `"[x|so|l] $INCLUDES $LIBS $DEFINES"`; with _x_ meaning produce an executable, _so_ a shared object and _l_ a static lib. Includes, libs and defines are simply a single `.` dot for do nothing, or a list of comma-separated items.

Here's a example in pseudo, you may do something like this in the scripting language of yor choice:

```
dir       = '~/my-projects';
libs      = '~/my-libs/,somelibrary';
includes  = '~/include-these/,~/buried/quite/deep/include-these-too/';
defines   = 'my_define=0xDE74,my_other_define=0xBEEE';

call avtomat dir config my-module "x $libs $includes $defines";
```

Because it is trivial to differentiate a proper path from a filename, avtomat does it; so do not specify -L and -l switches for libraries. Additionally, if you have a `lib` and `include` directory within your projects folder they'll be added to the search path avtmatically, so do not specify those either.

# THE TRASHCAN

avtomat creates a disposable directory within the projects folder called *trashcan*. This directory contains all intermediate files generated by a build; object files, pre-compiled headers, disassemblies, you name it. All those are put away in their own mirror folder structure in order to keep clutter away from your source files.

# BEWARE

Files generated by avtomat, as well as headers, version prints and related notices 
include this bit by default:

```perl
'Copyleft '.$AUTHOR.' '.$YEAR.'; Licensed under GNU GPL3';
```

Which means that if you do not agree with the license you will have to do the 
legal homework yourself there. But seriously? Just be a bro and inherit.
