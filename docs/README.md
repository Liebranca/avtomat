# AVTOMAT

This is a KISS build tool for C projects, though it can be used for other things as well.

Way it works: you write down short configs for your projects in the form of a Perl hash and call a few methods to generate build scripts.

# FEATURES

- **Shadow libs**: all of your code is archived; thus, anything you want to reuse from any project managed by avtomat can simply be included and linked against -- no need to shuffle files around or pollute your environment variables.

- **Dependency solver**: if a list of dependencies is passed to the build configuration of a library, then passing the name of that library to any subsequent build config will expand into the previously declared dependencies. This works recursively. In addition, avtomat reads dependency files generated by gcc, so includes are always checked when deciding if a file needs to be recompiled.

- **Generators**: avtomat offers some metaprogramming utilities, among them is a built-in generated files and generator scripts manager. You simply specify the source script or binary, the destination file to be created, and optionally a list of dependencies for the source script or binary -- everything else is handled by the build script.

- **Avto-FFI**: if a list of source or header files is provided for the purpose of creating bindings, then those files those files will be scanned for symbols, and bindings for other languages can later be created through a post build script. Currently, only Perl 5 is supported (through `FFI::Platypus`), but more languages will be added as needed.

# USAGE

First off, understand that avtomat expects to work with one top directory, and will try to find projects and files within that scope.

The following script demonstrates how to write an avtomat setup.

```perl

# import avtomat
use lib 'path/to/avtomat';
use avt;

# set your top directory
avt::root('/your/top/dir');

# set your library paths
unshift @ARGV,'/your/lib/path';
avt::stlib();

# configure your projects
my %config=(

  # only this field is mandatory
  # any other field, if skipped, means do nothing
  'NAME'=>'MyProject',

  # this field is meant for passing arguments
  # to the project files search function;
  # for now, it's only used to exclude paths
  'SCAN'=>'-x /path/to/exclude',

  # x:  make an executable
  # so: make a shared object
  # ar: make a static lib
  'BUILD'=>'x:my_elf',

  # copy machine;
  # XCPY moves files into topdir/bin
  # LCPY moves files into topdir/lib
  'XCPY'=>'my_executable*,not_an_executable',
  'LCPY'=>'my_lib.py',

  # defines files to be scanned for symbols
  # these are used for the avto-FFI
  'XPRT'=>'some_header.h,other_header.h',

  # generated files manager
  # syntax is: target:source*
  # alternative: target:[source*,deps,deps]
  'GENS'=>'my_file:my_script*',

  # paths to/names of libraries
  'LIBS'=>'X11,SDL2,SDL2main,proj/lib/',

  # self explanatory
  'INCL'=>'path/to/include/',

  # unused! but reserved for later plans ;>
  'DEFS'=>'this field is ignore (for now)',

);avt::strconfig \%config;

# invoke the build methods
avt::scan();
avt::config();
avt::make();


```

For an example script that sets up an actual project, refer to the `AR-install` file provided with avtomat.

# LEGAL

Files generated by avtomat, as well as headers, version prints and related notices include this bit by default:

```perl
'Copyleft '.$AUTHOR.' '.$YEAR.'; Licensed under GNU GPL3';
```

Which means that if you do not agree with the license you will have to modify this bit yourself. But why would you do that? Have some morals; spread GPL.
