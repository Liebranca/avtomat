# MINT

## SYNOPSIS

```perl

use Mint qw(image mount);

my $obj  = {...};
my $name = image 'path/to/out' => $obj;

my $cpy  = mount $name;

```

## DESCRIPTION

When tackling a complex problem that requires multiple abstractions to solve, one may run into a secondary issue: the deeper the program's structure, the harder it is to even think about storing it's state.

It'd be expected that, for each field required to reconstruct the main object, the corresponding class would either be generic enough that translating it's own fields to and from a binary representation would suffice, or that this class would have something akin to pack and unpack methods that define and handle an appropiate encoding.

`Mint` provides a minimalistic framework for this very task. All you need to know is four methods, two of them defined by the package itself, and another two *optionally* defined by each class if the aforementioned specificity in encoding is required.


The two interface methods are:

- `image`: given a filepath and an object, perform a recursive walk and apply either generic or specific encoding to each value in a nested structure; the result is written to disk using the provided filepath.

- `mount`: given a filepath, read a file generated by `image` and undo the process, returning a reconstruction of the object in question.


Both `image` and `mount` can handle generic encoding and decoding of values. When a class requires handling it's own encoding in a different manner, it must define two additional methods of it's own:

- `mint`: given a class instance, return a list of `key => value` pairs to be walked and stored.

- `unmint`: given a table of `key => value` pairs, return a class instance.


Each object may then choose to save only the fields it requires to regenerate itself; this works recursively, so that the same process applies to any of these fields that need a special encoding tactic.

If these methods are not defined, the object is simply stored as-is, with every field being encoded into the resulting binary and then loaded as such.


## A NOTE ON STORING SUBROUTINES

Subroutine references, named or anonymous, can be encoded by `Mint`. However, the guarantee that named subroutines can be found and run when an object is loaded depends entirely on the user having the corresponding packages installed.

As for anonymous subroutines, they *must* be self-contained, that is, they cannot reference external values outside of it's arguments. Consider the following:

```perl

sub mulref($xref,$y) {
  return sub {$$xref * $y};

};

my $x  = [0x24];
my $fn = mulref \$x->[0],2;

```

Though the above is valid perl, it's undecodable as both `$xref` and `$y` cannot be located solely within the scope of the anonymous subroutine; the recreation would then obviously fail.

This is because these subs are stored as source code that is then re-evaluated during decode; not a hard obstacle, as limited support for external references is theoretically possible if one attaches a fetching block for such values in the deparsed code.

Implementing it would mean parsing the source, identifying such unlocatable values, then locating them at the time of encoding -- possibly adding them to the inner dictionary of the resulting binary -- and then sneaking in the appropiate declarations and fetch hooks atop the resulting code.

However, while the implementation of this may very much be entirely within the realm of possibility, it is equally as possible that the edge-cases would multiply. And at the end of the day, it's still going out of our way only to support what we can generally consider terrible coding practice, and ss such, it is __firmly not supported__.


# CHANGELOG

### v0.00.7a

- Expanded support for classes requiring recursive solving of references, particularily those utilizing `Frame`, such as `Tree`.

### v0.00.6a

- Experimental loading of origin package for decoded subroutines.

- Several decode fixes; custom value processing functions can now be used.

- `proc`, `proc_elem` and `vex` internal methods are now used solely for encoding; the internal `from_bin` method now handles nearly the entirety of the decoding process.

### v0.00.4a

- Making of this file ;>

- Deprecated use of `Storable`.

- Initial testing of `to_bin` and `from_bin` methods to replace `Storable` calls.
